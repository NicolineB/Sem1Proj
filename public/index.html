<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="scripts/d3.js"></script>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <title>Vandstigninger</title>
    <script>
      const w = 700;
      const h = 400;
      const bottomPadding = 7;
      const sidePadding = 40;
      const topPadding = 20;

      //kalder waterlevels for at oprette den første svg
      waterlevels(2100);

      // Funktion finder valuen fra id'et chosenYear (input felt med år),
      // og gemmer det i variablen inputVal.
      function getInputValue() {
        let years = document.getElementById("chosenYear").value;
        if (years > 1996 && years < 2101) {
          document.getElementById("water-rise-title").innerHTML = "År " + years;
        } else {
          document.getElementById("water-rise-title").innerHTML =
            "Årstal ugyldigt";
        }
        update(years);
      }

      // d3.select("#submit").on("click", function (event) {
      //let input = d3.select("#submit").property("value");
      // console.log(input);
      // waterlevels(input, "b");
      // });

      //function til opdatering af svg - bliver kaldt af submit knappen
      //tager variabel 'years' og poster den som property til api/climate
      function update(years) {
        d3.json(`/api/climate/${years}`, {
          method: "POST",
        }).then(function (response) {
          //gemmer dataen for det valgte år i 'data'
          let data = response.data;
          console.log(data);
          let newData;
          const svg = d3.select("#svg1");

          //gemmer best_case og worst_case for år efter 2021
          //og gemmer observations for tidligere år...
          //gemmer det i 'newData' som bliver brugt som data herfra
          if (data[0].years >= 2022) {
            newData = [data[0].best_case, data[0].worst_case];
          } else if (data[0].years < 2022) {
            newData = [data[0].observations, data[0].observations];
          }
          //laver y-skala udfra højde og paddings
          const yScale = d3
            .scaleLinear()
            .domain([2, 0])
            .range([topPadding, h - bottomPadding]);

          //laver x-skala udfra hvor mange elementer vi har i dataen (som er 2)
          const xScale = d3
            .scaleBand()
            .domain(d3.range(newData.length))
            .range([0, w - 50]);

          //opretter updateSelection og tilkobler dataen
          const updateSelection = svg.selectAll("rect").data(newData);

          //bruger updateSelection til at opdatere vores svg
          updateSelection
            .transition()
            .duration(2000)
            .attr("x", function (d, i) {
              return xScale(i) + 41;
            })
            .attr("y", function (d) {
              return yScale(d);
            })
            .attr("width", xScale.bandwidth())
            .attr("height", function (d) {
              return h - yScale(d) - bottomPadding;
            });
        });
      }

      //waterlevels bliver brugt til at kalde vores api med en years parameter
      function waterlevels(years) {
        d3.json(`/api/climate/${years}`, {
          method: "POST",
        }).then(function (response) {
          let data = response.data;
          console.log(data);
          //kalder draw(data) for at lave svg udfra api data
          draw(data);
        });
      }

      //tegner vores svg og bliver kaldt af waterlevels
      function draw(data) {
        console.log(data[0].years);
        console.log(data.length);
        let newData;
        const svg = d3
          .select("#svg1")
          .append("svg")
          .attr("width", w)
          .attr("height", h);

        // laver skala for y-akse
        const yScale = d3
          .scaleLinear()
          .domain([2, 0])
          .range([topPadding, h - bottomPadding]);

        // tegner en y-akse med tal
        const yAxis = d3.axisLeft().scale(yScale).ticks(8);
        svg
          .append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + sidePadding + ",0)")
          .call(yAxis)
          .style("font-size", "20px");

        //gemmer den relevante data i newData an på om det er før eller efter 2022
        if (data[0].years < 2022) {
          newData = [data[0].observations, data[0].observations];
        } else if (data[0].years >= 2022) {
          newData = [data[0].best_case, data[0].worst_case];
        }

          // Observation har vi kun fra før 2022
          // Når 2022 ændres den til best_case, og worst_case 
          d3.selectAll("observation_nr").each(function(d, i){
            var obs_ = d3.index(data[0].observations);
            console.log(data[0].observations);
          });



        //laver x-akse udfra newData
        const xScale = d3
          .scaleBand()
          .domain(d3.range(newData.length))
          .range([0, w - 50]);

        //tegner vores svg
        svg
          .selectAll("rect")
          .data(newData)
          .enter()
          .append("rect")
          .attr("x", function (d, i) {
            return xScale(i) + 41;
          })
          .attr("y", function (d) {
            return yScale(d);
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function (d) {
            return h - yScale(d) - bottomPadding;
          })
          .attr("fill", "blue")
          .attr("opacity", 0.5);
      }

      // Knappen vælges via dens id 'klik'
      const submitClick = d3
        .selectAll("#submit")
        // Koden herunder køres kun ved tryk på knappen
        .on("click", function (e) {
          // Find hvilken knap der blev trykket på
          const id = e.target.id;
          // where year = ID
          console.log(id);
        });

      d3.json("/api/climate", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af response
        console.log("data", data);

        // set the dimensions and margins of the graph
        const margin = { top: 10, right: 30, bottom: 30, left: 60 },
          width = 460 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        const svg = d3
          .select(data)
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr(
            "transform",
            "translate(" + margin.left + "," + margin.top + ")"
          );

        // Add X axis --> it is a date format
        var x = d3
          .scaleTime()
          .domain(
            d3.extent(data, function (d) {
              return d.years;
            })
          )
          .range([0, width]);
        svg
          .append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3
          .scaleLinear()
          .domain([
            0,
            d3.max(data, function (d) {
              return +d.temp_rise;
            }),
          ])
          .range([height, 0]);
        svg.append("g").call(d3.axisLeft(y));

        // Add the line
        svg
          .append("path")
          .datum(data)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-width", 1.5)
          .attr(
            "d",
            d3
              .line()
              .x(function (d) {
                return x(d.years);
              })
              .y(function (d) {
                return y(d.temp_rise);
              })
          );
      });
    </script>

    <script>
      //animal data
      d3.json(`/api/animal`, {
        method: "POST",
      }).then(function (response) {
        let data = response.data;
        console.log(data);
        data.sort((a, b) => d3.descending(parseFloat(a.percent_at_risk), parseFloat(b.percent_at_risk)));

        const w = 1000;
        const h = 550;
        const bottomPadding = 7;
        const sidePadding = 40;
        const topPadding = 20;

        const svg = d3
          .select("#svg2")
          .append("svg")
          .attr("width", w)
          .attr("height", h);

        // laver skala for y-akse
        const yScale = d3
          .scaleLinear()
          .domain([100, 0])
          .range([topPadding, h - bottomPadding]);

        // tegner en y-akse med tal
        const yAxis = d3.axisLeft().scale(yScale).ticks(10);
        svg
          .append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + sidePadding + ",0)")
          .call(yAxis)
          .style("font-size", "20px");

        const xScale = d3
          .scaleBand()
          .domain(d3.range(data.length))
          .range([0, w - 44]);

        //tegner vores svg
        svg
          .selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          .attr("x", function (d, i) {
            return xScale(i) + 44;
          })
          .attr("y", function (d) {
            return yScale(d.percent_at_risk);
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function (d) {
            return h - yScale(d.percent_at_risk) - bottomPadding;
          })
          .attr("fill", "green");
      });
    </script>
  </head>
  <body>
    <section class="infoslide" id="infoSlide">
      <h1 id="main-title">
        Som tiden går, <span class="color-emphasis-1">stiger vandene</span>
      </h1>
      <h3>
        Og det har indflydelse på dyrene, planterne,
        <span class="color-emphasis-1">dig og mig</span>
      </h3>
      <h4 class="scrollVidere">Scroll videre for at høre mere</h4>
      <div class="wave wave1"></div>
      <div class="wave wave2"></div>
      <div class="wave wave3"></div>
      <div class="wave wave4"></div>
      <!--figur til at illustere at scroll ned-->
      <a class="scroll-down arrow">
        <label></label>
        <span></span>
      </a>
    </section>

    <section class="water-rise" id="waterRise">
      <h1 id="water-rise-title">Hvor meget vil vandet stige?</h1>
      <h2 id="water-rise-under-title">
        Vælg venlist årstal mellem 1997, og 2100.
      </h2>
      <form>
        <p>
          <input
            type="number"
            placeholder="YYYY"
            min="1997"
            max="2100"
            id="chosenYear"
          />
          <!--Når button trykkes kører getInputValue funktionen-->
          <button type="button" onclick="getInputValue();">Submit</button>
        </p>
      </form>
      <!-- evt plus minus antal år her-->
      <!--To col / grid med to - visualisering col1, boks anden-->
      <div class="container">
        <div class="col1">
          <div id="svg1" class="svg1"></div>
        </div>
        <div class="col2">
          <div class="col2-container">
            <h2>Here will a title be</h2>
            <article>
              <p>Information goes here</p>
              <!--Evt. variable som referer til data fra året-->
            </article>
            <!--figur til at illustere at scroll ned-->
          </div>
        </div>
      </div>
    </section>
    <section>
      <h1 id="animalTitle">Animals at risk</h1>
      <div class="container2">
        <div class="consequences">
          <div id="svg2" class="svg2"></div>
        </div>
        <div class="consequences2">
          <h2>eventuel info?</h2>
          <article>
            <p>eventuel info?</p>
          </article>
        </div>
      </div>
    </section>
    <section class="not-fun-facts">
      <h1><b>Not-So-Fun Facts</b></h1>
      <h3>Træk musen henover billederne for at se mere</h3>
      
      <div class="flip-card">
        <div class="flip-card-inner">
          <div class="flip-card-front">
            <img src="css/1.png" style="width:100%;height:300px;">
            <div class="title"><b>Fugle bliver hjemløse</b></div>
          </div>
          <p class="flip-card-back">
            <br><b><u>Over halvdelen af strandengene vil forsvinde I løbet af de næste år.</u></b>
            Det er først og fremmest de dyr, der er tilknyttet strandengene, der kommer til at forsvinde.
            Det er vadefugle som engryle, brushane, stor kobbersneppe, rødben og så videre.
            En stor del af de mange sjældne fugle, dyr og planter, som findes på strandengene langs de danske kyster, er alvorligt truet af udryddelse.</br> 
            <a href="https://www.cowi.dk/om-cowi/nyheder-og-presse/ny-rapport-danmarks-kystnatur-alvorligt-truet">COWI.dk</a>
          </p>
          </div>
        </div>
      </div>
      </br>
      <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="css/2.png" style="width:100%;height:300px;">
              <div class="title"><b>Øget CO2 udledning</b></div>
            </div>
            <div class="flip-card-back">
              <p>Strandengene har en vigtig funktion i form af nærings- og CO₂ optagelse, og tabet af strandenge vil derfor føre til en væsentlig øget næringsbelastning af de kystnære farvande og øget CO₂ udledning.</p> 
              <a href=https://www.cowi.dk/om-cowi/nyheder-og-presse/ny-rapport-danmarks-kystnatur-alvorligt-truet>COWI.dk</a>
            </div>
          </div>
        </div>
      </br>
        <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="css/3.png" style="width:100%;height:300px;">
              <div class="title"><b>Skildpadder sulter</b></div>
            </div>
            <div class="flip-card-back">
              <p>Skildpadder der bor I Oceanien og Nordamerika står overfor de største trusler. Når vandene stiger, stiger saltindholdet og det kan deres kroppe ikke behandle. Så de stopper helt med at spise og drikke indtil saltindholdet falder igen. I og med at vandene ikke falder igen efter nok vandstigning, og saltindholdet dermed ikke falder, så bliver skildpadderne ved med at sulte dem selv. </p> 
              <a href="https://www.cowi.dk/om-cowi/nyheder-og-presse/ny-rapport-danmarks-kystnatur-alvorligt-truet">COWI.dk</a>
            </div>
          </div>
        </div>
      </br>
      <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="css/4.png" style="width:100%;height:300px;">
              <div class="title"><b>Flere stormfloder, større oversvømmelser</b></div>
            </div>
            <div class="flip-card-back">
              <p>Ændringerne I vandstanden sammen med ændrende vindmønstre fører til øgede stormflodshøjder, især I Vadehavet. Dvs. at over halvdelen af både Frederiksværk på Nordsjælland og Randers i Østjylland vil oversvømmes i 2115.</p> 
              <a href="https://realdania.dk/publikationer/faglige-publikationer/tilpasning-til-havvandsstigninger-rapport">Realdania.dk</a>
            </div>
          </div>
        </div>
      </br>
      </section>
    <footer></footer>
  </body>
</html>