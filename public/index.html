<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="scripts/d3.js"></script>
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <title>Vandstigninger</title>
    <script>
      const w = 700;
      const h = 400;
      const bottomPadding = 7;
      const sidePadding = 40;
      const topPadding = 20;

      //kalder waterlevels for at oprette den første svg
      waterlevels(2100);

      // Funktion finder valuen fra id'et chosenYear (input felt med år),
      // og gemmer det i variablen inputVal.
      function getInputValue() {
        let years = document.getElementById("chosenYear").value;
        if (years > 1996 && years < 2101) {
          document.getElementById("water-rise-title").innerHTML = "År " + years;
        } else {
          document.getElementById("water-rise-title").innerHTML =
            "Årstal ugyldigt";
        }
        update(years);
      }

      // d3.select("#submit").on("click", function (event) {
      //let input = d3.select("#submit").property("value");
      // console.log(input);
      // waterlevels(input, "b");
      // });

      //function til opdatering af svg - bliver kaldt af submit knappen
      //tager variabel 'years' og poster den som property til api/climate
      function update(years) {
        d3.json(`/api/climate/${years}`, {
          method: "POST",
        }).then(function (response) {
          //gemmer dataen for det valgte år i 'data'
          let data = response.data;
          console.log(data);
          let newData;
          const svg = d3.select("#svg1");

          //gemmer best_case og worst_case for år efter 2021
          //og gemmer observations for tidligere år
          //gemmer det i 'newData' som bliver brugt som data herfra
          if (data[0].years >= 2022) {
            newData = [data[0].best_case, data[0].worst_case];
          } else if (data[0].years < 2022) {
            newData = [data[0].observations, data[0].observations];
          }
          //laver y-skala udfra højde og paddings
          const yScale = d3
            .scaleLinear()
            .domain([2, 0])
            .range([topPadding, h - bottomPadding]);

          //laver x-skala udfra hvor mange elementer vi har i dataen (som er 2)
          const xScale = d3
            .scaleBand()
            .domain(d3.range(newData.length))
            .range([0, w - 50]);

          //opretter updateSelection og tilkobler dataen
          const updateSelection = svg.selectAll("rect").data(newData);

          //bruger updateSelection til at opdatere vores svg
          updateSelection
            .transition()
            .duration(2000)
            .attr("x", function (d, i) {
              return xScale(i) + 41;
            })
            .attr("y", function (d) {
              return yScale(d);
            })
            .attr("width", xScale.bandwidth())
            .attr("height", function (d) {
              return h - yScale(d) - bottomPadding;
            });
        });
      }

      //waterlevels bliver brugt til at kalde vores api med en years parameter
      function waterlevels(years) {
        d3.json(`/api/climate/${years}`, {
          method: "POST",
        }).then(function (response) {
          let data = response.data;
          console.log(data);
          //kalder draw(data) for at lave svg udfra api data
          draw(data);
        });
      }

      //tegner vores svg og bliver kaldt af waterlevels
      function draw(data) {
        console.log(data[0].years);
        console.log(data.length);
        let newData;
        const svg = d3
          .select("#svg1")
          .append("svg")
          .attr("width", w)
          .attr("height", h);

        // laver skala for y-akse
        const yScale = d3
          .scaleLinear()
          .domain([2, 0])
          .range([topPadding, h - bottomPadding]);

        // tegner en y-akse med tal
        const yAxis = d3.axisLeft().scale(yScale).ticks(8);
        svg
          .append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + sidePadding + ",0)")
          .call(yAxis)
          .style("font-size", "20px");

        //gemmer den relevante data i newData an på om det er før eller efter 2022
        if (data[0].years < 2022) {
          newData = [data[0].observations, data[0].observations];
        } else if (data[0].years >= 2022) {
          newData = [data[0].best_case, data[0].worst_case];
        }

        //laver x-akse udfra newData
        const xScale = d3
          .scaleBand()
          .domain(d3.range(newData.length))
          .range([0, w - 50]);

        //tegner vores svg
        svg
          .selectAll("rect")
          .data(newData)
          .enter()
          .append("rect")
          .attr("x", function (d, i) {
            return xScale(i) + 41;
          })
          .attr("y", function (d) {
            return yScale(d);
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function (d) {
            return h - yScale(d) - bottomPadding;
          })
          .attr("fill", "blue")
          .attr("opacity", 0.5);
      }

      // Knappen vælges via dens id 'klik'
      const submitClick = d3
        .selectAll("#submit")
        // Koden herunder køres kun ved tryk på knappen
        .on("click", function (e) {
          // Find hvilken knap der blev trykket på
          const id = e.target.id;
          // where year = ID
          console.log(id);
        });
    </script>
    <script>
      /* d3.json("/api/species", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af respons
        console.log("data", data);

        const w = 500;
        const h = 350;

        const yScale = d3.scaleLinear()
        .domain([0, d3.max(data)])
        .range([0, h]);

        // Lav SVG element
        const svg2 = d3
          .select("body")
          .append("svg")
          .attr("width", w)
          .attr("height", h);

        // Lav bars til barchart
        svg.selectAll("rect")
            .data(data)
            .enter()
            .append("rect")
            // x værdi er længden af species datasættet
            .attr("x", function(d, i) { return i * (w / data.length) - 15;
            })
            .attr("y", function(d) { return h - yScale(d)})
            .attr("width", w / data.length - barPadding)
            .attr("height", function(d) { return yScale(d);})
            .attr("fill", "red");
            */
    </script>
  </head>
  <body>
    <section class="infoslide" id="infoSlide">
      <h1 id="main-title">
        Som tiden går, <span class="color-emphasis-1">stiger vandene</span>
      </h1>
      <h3>
        Og det har indflydelse på dyrene, planterne,
        <span class="color-emphasis-1">dig og mig</span>
      </h3>
      <h4 class="scrollVidere">Scroll videre for at høre mere</h4>
      <div class="wave wave1"></div>
      <div class="wave wave2"></div>
      <div class="wave wave3"></div>
      <div class="wave wave4"></div>
      <!--figur til at illustere at scroll ned-->
      <a class="scroll-down arrow">
        <label></label>
        <span></span>
      </a>
    </section>

    <section class="water-rise" id="waterRise">
      <h1 id="water-rise-title">Hvor meget vil vandet stige?</h1>
      <h2 id="water-rise-under-title">Vælg venlist årstal mellem 1997, og 2100.</h2>
      <form>
        <p>
          <input
            type="number"
            placeholder="YYYY"
            min="1997"
            max="2100"
            id="chosenYear"
          />
          <!--Når button trykkes kører getInputValue funktionen-->
          <button type="button" onclick="getInputValue();">Submit</button>
        </p>
      </form>
      <!-- evt plus minus antal år her-->
      <!--To col / grid med to - visualisering col1, boks anden-->
      <div class="container">
        <div class="col1">
          <div id="svg1" class="svg1"></div>
        </div>
        <div class="col2">
          <div class="col2-container">
            <h2>Here will a title be</h2>
            <article>
              <p>Information goes here</p>
              <!--Evt. variable som referer til data fra året-->
            </article>
            <!--figur til at illustere at scroll ned-->
          </div>
        </div>
      </div>
    </section>

    <section class="consequences" id="consequences">
      <h1>Det ser ikke ud af meget <bold>men.....</bold></h1>
    </section>

    <section class="marine-life" id="marineLife">
      <h1 id="marine-title">Here goes a title</h1>
    </section>

    <section class="not-fun-facts" id="notFunFacts">
      <article class="fact-container">
        <div id="fact-1">
          <div id="fact-text">Tester</div>
          <img src="//" class="fact-1-pic" />
          <p>here something will be</p>
        </div>
        <div class="fact-2">
          <img src="//" class="fact-2-pic" />
          <p>Here something will be</p>
        </div>
        <div class="fact-3">
          <img src="//" class="fact-2-pic" />
          <p>here something will be</p>
        </div>
      </article>
    </section>

    <footer></footer>
  </body>
</html>
